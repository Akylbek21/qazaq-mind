import{R as l,j as e,m as h}from"./index-CVxrc5Ku.js";import{g as U,p as _}from"./client-DYrIeA2N.js";import{A as $}from"./index-DICw-uEz.js";const k={RANDOM_CARD:"/api/eq/card/random",SUBMIT:"/api/eq/submit"},J=s=>Array.isArray(s)?s:typeof s=="string"?s.split(",").map(a=>a.trim()).filter(Boolean):[];async function q(s={}){const a=await U(k.RANDOM_CARD,s);return{id:a?.id,text:a?.text??"",tags:J(a?.tags)}}async function B({cardId:s,text:a,audioUrl:n=null},c={}){if(!s)throw new TypeError("submitEQAnswer: cardId обязателен");if(!a||!a.trim())throw new TypeError("submitEQAnswer: text обязателен");return _(k.SUBMIT,{cardId:s,text:a,audioUrl:n},c)}const F=[],E="realtalktime_answers_v1";function d(){try{return JSON.parse(localStorage.getItem(E)||"{}")}catch{return{}}}function C(s,a){const n=d();n[s]={text:a,updatedAt:new Date().toISOString()},localStorage.setItem(E,JSON.stringify(n))}function G(){const[s,a]=l.useState(null),[n,c]=l.useState(!1),[x,g]=l.useState(""),[m,f]=l.useState(""),[b,T]=l.useState(""),[u,o]=l.useState({ok:!1,msg:""}),[r,j]=l.useState(null),[N,y]=l.useState(""),[v,R]=l.useState(()=>d()),[p,L]=l.useState(""),w=async()=>{c(!0),g(""),o({ok:!1,msg:""});try{const t=await q();a(t);const i=d()?.[`card:${t.id}`]?.text||"";f(i)}catch(t){g(t?.message||"Карточканы жүктеу мүмкін болмады.")}finally{c(!1)}};l.useEffect(()=>{w()},[]);const O=()=>{s&&(C(`card:${s.id}`,m),o({ok:!0,msg:"Черновик сақталды (жергілікті)."}))},D=async()=>{if(s){o({ok:!1,msg:""});try{await B({cardId:s.id,text:m.trim(),audioUrl:b.trim()||null}),o({ok:!0,msg:"Жауап серверге жіберілді. Рақмет!"})}catch(t){o({ok:!1,msg:t?.message||"Жіберу сәтсіз."})}}},Q=t=>{y(v?.[t.id]?.text||""),j(t)},S=()=>j(null),I=()=>{r&&(C(r.id,N),R(d()))},M=F.filter(t=>t.title.toLowerCase().includes(p.toLowerCase())||t.prompts.some(i=>i.toLowerCase().includes(p.toLowerCase())));return e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 py-10",children:[e.jsxs(h.h1,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.45},className:"text-3xl md:text-4xl font-extrabold text-slate-900 text-center",children:["SeLFtALK (EQ) — ",e.jsx("span",{className:"text-[#1F7A8C]",children:"«СӨЙЛЕ, СЕЗІН, БӨЛІС»"})]}),e.jsxs("p",{className:"mt-2 text-center text-slate-600",children:["Жоғарыда — ",e.jsx("b",{children:"серверлік EQ-карточка"})," (рандом). Төменде — сенің ",e.jsx("b",{children:"галереяң"})," (жергілікті сақталады)."]}),e.jsxs("div",{className:"mt-8 rounded-2xl border border-slate-200 bg-white/80 backdrop-blur p-5 shadow",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"EQ-карточка (сервер)"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("button",{onClick:w,disabled:n,className:"rounded-xl border border-slate-300 px-4 py-2 text-sm font-semibold hover:bg-slate-50 disabled:opacity-40",children:n?"Жүктелуде…":"Жаңа карточка"})})]}),x&&e.jsx("p",{className:"mt-3 text-sm text-rose-600",children:x}),s&&!x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-slate-700 leading-relaxed",children:s.text}),Array.isArray(s.tags)&&s.tags.length>0&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:s.tags.map(t=>e.jsxs("span",{className:"rounded-full border px-3 py-1 text-xs text-slate-600 bg-slate-50",children:["#",t]},t))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Жауабың:"}),e.jsx("textarea",{value:m,onChange:t=>f(t.target.value),rows:6,className:"mt-2 w-full rounded-xl border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-teal-500/60",placeholder:"Осы жерге жазыңыз…"}),e.jsxs("div",{className:"mt-2 grid gap-2 md:grid-cols-2",children:[e.jsx("input",{value:b,onChange:t=>T(t.target.value),placeholder:"Опционально: Audio URL (мысалы, CDN/Cloud)",className:"rounded-xl border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-teal-500/60"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:O,className:"rounded-xl border border-slate-300 px-4 py-2 font-semibold text-slate-700 hover:bg-slate-50",children:"Сақтау (локал)"}),e.jsx("button",{onClick:D,className:"rounded-xl bg-[#1aa6b5] text-white font-semibold px-4 py-2 hover:opacity-95",children:"Жіберу (сервер)"})]})]}),u.msg&&e.jsx("p",{className:`mt-2 text-sm ${u.ok?"text-emerald-700":"text-rose-700"}`,children:u.msg})]})]})]}),e.jsx("div",{className:"mt-10 flex justify-center",children:e.jsx("input",{value:p,onChange:t=>L(t.target.value),placeholder:"Іздеу: «ана», «қоғам», «тыныс»…",className:"w-full md:w-2/3 rounded-xl border border-slate-200 px-4 py-3 outline-none focus:ring-2 focus:ring-teal-500/60"})}),e.jsx("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:M.map(t=>{const i=v?.[t.id]?.text?.trim();return e.jsxs("button",{onClick:()=>Q(t),className:"text-left rounded-2xl border border-slate-200 bg-white/80 backdrop-blur p-5 shadow hover:-translate-y-0.5 hover:shadow-lg transition group",children:[e.jsx("div",{className:`rounded-xl bg-gradient-to-r ${t.color} p-3 w-12 h-12 flex items-center justify-center text-xl`,children:t.icon}),e.jsx("h3",{className:"mt-3 text-lg font-bold text-slate-900",children:t.title}),e.jsx("p",{className:"text-sm text-slate-500",children:t.goal}),e.jsx("ul",{className:"mt-3 text-sm text-slate-600 list-disc pl-5 space-y-1",children:t.prompts.slice(0,2).map(A=>e.jsx("li",{className:"line-clamp-2",children:A},A))}),i&&e.jsx("div",{className:"mt-3 inline-flex items-center text-xs font-medium text-teal-700",children:"✓ Жауап сақталған"})]},t.id)})}),e.jsx($,{children:r&&e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/40 flex items-end md:items-center justify-center p-4",onClick:S,children:e.jsxs(h.div,{initial:{y:30,opacity:0},animate:{y:0,opacity:1},exit:{y:30,opacity:0},transition:{type:"spring",stiffness:180,damping:20},className:"relative max-h-[90vh] w-full md:w-[720px] rounded-2xl bg-white p-6 shadow-xl overflow-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`rounded-xl bg-gradient-to-r ${r.color} p-3 w-12 h-12 flex items-center justify-center text-xl`,children:r.icon}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:r.title}),e.jsx("p",{className:"text-slate-600 text-sm",children:r.goal})]})]}),e.jsx("div",{className:"mt-4 space-y-2",children:r.prompts.map((t,i)=>e.jsxs("p",{className:"text-slate-700 text-sm leading-relaxed",children:["• ",t]},i))}),e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-semibold text-slate-700",children:"Жауабың:"}),e.jsx("textarea",{value:N,onChange:t=>y(t.target.value),rows:6,className:"mt-2 w-full rounded-xl border border-slate-300 px-3 py-2 outline-none focus:ring-2 focus:ring-teal-500/60",placeholder:"Осы жерге жазыңыз…"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[e.jsx("button",{onClick:I,className:"rounded-xl bg-[#1aa6b5] text-white font-semibold px-4 py-2 hover:opacity-95",children:"Сақтау"}),e.jsx("button",{onClick:S,className:"rounded-xl border border-slate-300 px-4 py-2 font-semibold text-slate-700 hover:bg-slate-50",children:"Жабу"})]})]}),e.jsx("p",{className:"mt-3 text-xs text-slate-500",children:"Кеңес: дауыстық жауап жазғың келсе, телефон диктовкасын қолдан (не енгіз де, Submit (сервер) жоғарыда)."})]})},r.id)})]})}export{G as default};
//# sourceMappingURL=RealTalkTime-Bg7mM6cv.js.map
