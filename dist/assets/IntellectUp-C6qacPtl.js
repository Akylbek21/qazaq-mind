import{r as l,j as e,m as C}from"./index-CVxrc5Ku.js";import{g as O,p as ie}from"./client-DYrIeA2N.js";const q={TESTS:"/api/iq/tests",TEST_QUESTIONS:t=>`/api/iq/tests/${t}/questions`,ANSWER:"/api/iq/answer",TEST_SUMMARY:t=>`/api/iq/tests/${t}/summary`},U=(t,r)=>{if(r==null||r===""||Number.isNaN(Number(r)))throw new TypeError(`${t}: обязателен и должен быть числом/строкой ID`);return r},oe=t=>{const r=String(t??"").trim().toUpperCase();if(!["A","B","C","D"].includes(r))throw new TypeError("chosen должен быть A/B/C/D");return r};function ce(t={}){return O(q.TESTS,t)}function de(t,r={}){return O(q.TEST_QUESTIONS(U("fetchIQTestQuestions.testId",t)),r)}function me({questionId:t,chosen:r},c={}){const m=U("submitIQAnswer.questionId",t),p=oe(r);return ie(q.ANSWER,{questionId:m,chosen:p},c)}function ue(t,r={}){return O(q.TEST_SUMMARY(U("fetchIQTestSummary.testId",t)),r)}function W({to:t,className:r="",children:c,...m}){let p=null;try{p=require("react-router-dom").useInRouterContext}catch{}if(!(p?.()??!1))return e.jsx("a",{href:t,className:r,...m,children:c});const{Link:w}=require("react-router-dom");return e.jsx(w,{to:t,className:r,...m,children:c})}const z="intellect_up_stats_pure_api",xe=()=>{try{return JSON.parse(localStorage.getItem(z)||"{}")}catch{return{}}},he=t=>localStorage.setItem(z,JSON.stringify(t));function fe(t){const r=[t.optionA,t.optionB,t.optionC,t.optionD].filter(Boolean);return{id:t.id,q:t.prompt??"",options:r,imageUrl:t.imageUrl||t.image||null,domain:t.domain||null,correctLetter:t.correct||null}}const pe=t=>["A","B","C","D"][t]??null,be=(t,r)=>{if(!t||!Array.isArray(t.options))return null;const c=t.options.findIndex(m=>m===r);return c>=0?pe(c):null};function ge(){const[t,r]=l.useState([]),[c,m]=l.useState(null),[p,_]=l.useState([]),[w,B]=l.useState(60),[v,I]=l.useState(!1),[b,T]=l.useState(""),[h,$]=l.useState(!1),[s,y]=l.useState(0),[j,k]=l.useState({}),[u,g]=l.useState(!1),[Q,L]=l.useState(60),[A,G]=l.useState(()=>xe()),[a,H]=l.useState([]),D=l.useRef(null),[V,M]=l.useState(!1),[P,E]=l.useState(""),[f,N]=l.useState(null),R=l.useCallback(async()=>{I(!0),T(""),N(null);try{const n=await ce();r(Array.isArray(n)?n:[]),B(60),!c&&Array.isArray(n)&&n.length>0&&m(n[0].id)}catch(n){T(n?.message||"Қате: тесттер тізімі жүктелмеді.")}finally{I(!1)}},[c]);l.useEffect(()=>{R()},[R]);const J=async()=>{E(""),N(null);const n=c??t[0]?.id;if(!n){T("Тесттер жоқ.");return}try{I(!0);const o=await de(n),i=(Array.isArray(o)?o:[]).map(fe);_(i),H(i),$(!0),y(1),L(w),k({}),g(!1),D.current=Date.now(),m(n)}catch(o){T(o?.message||"Сұрақтарды жүктеу қатесі.")}finally{I(!1)}},X=()=>{$(!1),y(0),k({}),g(!1),L(w),E(""),N(null),D.current=null};l.useEffect(()=>{if(!h||u)return;const n=setInterval(()=>{L(o=>o<=1?(clearInterval(n),g(!0),0):o-1)},1e3);return()=>clearInterval(n)},[h,u]);const F=l.useCallback(n=>{if(!h||u||s===0)return;const o=s-1,i=a[o]?.options||[];if(n.key>="1"&&n.key<="4"){const d=Number(n.key)-1;i[d]&&k(x=>({...x,[o]:i[d]}))}n.key==="Enter"&&Object.prototype.hasOwnProperty.call(j,o)&&(s<a.length?y(d=>d+1):g(!0))},[j,u,a,h,s]);l.useEffect(()=>(window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)),[F]);const S=l.useMemo(()=>0,[]),Z=(n,o)=>k(i=>({...i,[n]:o})),ee=()=>s<a.length?y(s+1):g(!0),te=()=>s>1?y(s-1):null,se=s===0||!a.length?0:Math.round((s-1)/a.length*100),ne=Q>30?"text-emerald-600":Q>15?"text-amber-600":"text-rose-600";l.useEffect(()=>{if(!u||!c)return;const n=(A.attempts||0)+1,o=Math.max(A.best||0,S),i={attempts:n,best:o,last:S,lastAt:Date.now()};G(i),he(i),(async()=>{M(!0),E("");try{const d=a.map((Y,re)=>{const ae=j[re]??null,K=be(Y,ae);return K?me({questionId:Y.id,chosen:K}):null}).filter(Boolean);await Promise.allSettled(d);const x=await ue(c);N({score:Number(x?.correct??0),total:Number(x?.total??a.length),details:x,message:"Server summary"})}catch(d){E(d?.message||"Сервер нәтижесін алу мүмкін болмады."),N(null)}finally{M(!1)}})()},[u,c]);const le=()=>{const n=typeof f?.total=="number"?f.total:a.length,o=typeof f?.score=="number"?f.score:S;return e.jsxs(e.Fragment,{children:[!h&&!u&&s===0&&e.jsx(C.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"mt-6 text-center",children:e.jsxs("div",{className:"mt-2 flex flex-col items-center gap-3",children:[v&&e.jsx("div",{className:"text-sm text-slate-500",children:"Жүктелуде…"}),b&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm text-rose-600",children:b}),e.jsx("button",{onClick:R,className:"rounded-xl px-4 py-2 border font-semibold",children:"Қайталап көру"})]}),!v&&!b&&t.length>0&&e.jsxs("div",{className:"w-full max-w-xs text-left",children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Тест таңдау"}),e.jsx("select",{value:c??t[0]?.id??"",onChange:i=>m(Number(i.target.value)),className:"w-full rounded-xl border px-3 py-2",children:t.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))})]}),!v&&!b&&e.jsx("button",{onClick:J,disabled:!t.length,className:"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-[#1F7A8C] text-white font-semibold shadow hover:opacity-95 disabled:opacity-40",children:"Бастау"}),!v&&!b&&t.length===0&&e.jsx("div",{className:"text-sm text-slate-500",children:"Тесттер жоқ."})]})}),h&&!u&&e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm text-slate-600 mb-2",children:[e.jsxs("span",{children:["Сұрақ ",s,"/",a.length]}),e.jsxs("span",{className:`font-semibold ${ne}`,children:["Қалған уақыт: ",Q," с"]})]}),e.jsx("div",{className:"w-full h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-2 bg-gradient-to-r from-[#1F7A8C] to-[#1aa6b5] transition-all",style:{width:`${se}%`}})})]}),h&&!u&&s>0&&a.length>0&&e.jsxs(C.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"mt-6 rounded-2xl border border-slate-200 bg-white/80 backdrop-blur p-5 shadow",children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:a[s-1].q}),a[s-1].imageUrl?e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("img",{src:a[s-1].imageUrl,alt:a[s-1].q?.slice(0,120)??"question image",className:"max-h-48 w-auto rounded-lg object-contain border border-slate-200"})}):null,e.jsx("div",{className:"mt-4 grid gap-3",children:a[s-1].options.map((i,d)=>{const x=j[s-1]===i;return e.jsx("button",{onClick:()=>Z(s-1,i),className:`text-left rounded-xl border px-4 py-3 transition focus:outline-none focus:ring-2 focus:ring-sky-400 ${x?"border-[#1F7A8C] bg-[#1F7A8C]/10":"border-slate-200 hover:bg-slate-50"}`,"aria-pressed":x,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold
                        ${x?"bg-[#1F7A8C] text-white":"bg-slate-200 text-slate-700"}`,children:d+1}),e.jsx("span",{children:i})]})},`${a[s-1].id}-${d}`)})}),e.jsxs("div",{className:"mt-5 flex justify-between items-center",children:[e.jsx("button",{onClick:te,disabled:s===1,className:"inline-flex items-center justify-center rounded-xl px-4 py-2 border border-slate-300 font-medium text-slate-700 disabled:opacity-40",children:"⟵ Артқа"}),e.jsx("div",{className:"text-slate-500 text-sm hidden sm:block",children:"1–4 пернелерімен таңдауға болады"}),e.jsx("button",{onClick:ee,disabled:!Object.prototype.hasOwnProperty.call(j,s-1),className:"inline-flex items-center justify-center rounded-xl px-5 py-2.5 bg-slate-900 text-white font-medium disabled:opacity-40",children:s<a.length?"Келесі ⟶":"Аяқтау"})]})]},s),u&&e.jsxs(C.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"mt-10 rounded-2xl border border-slate-200 bg-white/80 backdrop-blur p-6 shadow",children:[e.jsx("h3",{className:"text-2xl font-bold text-slate-900",children:"Нәтиже"}),V&&e.jsx("p",{className:"mt-2 text-slate-600 text-sm",children:"Серверден тексеру…"}),P&&e.jsx("p",{className:"mt-2 text-rose-600 text-sm",children:P}),e.jsxs("p",{className:"mt-2 text-slate-700",children:["Ұпай: ",e.jsxs("span",{className:"font-semibold",children:[o," / ",n]}),f?.message?e.jsxs("span",{className:"ml-2 text-slate-500 text-sm",children:["(",f.message,")"]}):null]}),e.jsxs("div",{className:"mt-6 grid sm:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("p",{className:"text-slate-500",children:"Соңғы ұпай (локал)"}),e.jsxs("p",{className:"mt-1 font-semibold",children:[S," / ",a.length]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("p",{className:"text-slate-500",children:"Ең үздік нәтиже"}),e.jsxs("p",{className:"mt-1 font-semibold",children:[Math.max(A.best??0,S)," / ",a.length]})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("p",{className:"text-slate-500",children:"Талпыныс саны"}),e.jsx("p",{className:"mt-1 font-semibold",children:A.attempts??1})]})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[e.jsx("button",{onClick:J,className:"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-slate-900 text-white font-semibold",children:"Қайта өту"}),e.jsx("button",{onClick:X,className:"inline-flex items-center justify-center rounded-xl px-5 py-3 border border-slate-300 font-semibold text-slate-700 hover:bg-slate-50",children:"Басты экран"})]})]})]})};return e.jsxs("div",{className:"container mx-auto max-w-5xl px-4 py-10",children:[e.jsx(C.h1,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"text-3xl md:text-4xl font-extrabold text-slate-900 text-center",children:"IntellectUp — Danalyq Challenge (IQ)"}),e.jsx("div",{className:"mt-8",children:le()}),e.jsxs("div",{className:"mt-8 flex flex-wrap gap-3 justify-center",children:[e.jsx(W,{to:"/realtalk",className:"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-[#1aa6b5] text-white font-semibold shadow hover:opacity-95",children:"RealTalkTime (EQ)"}),e.jsx(W,{to:"/",className:"inline-flex items-center justify-center rounded-xl px-5 py-3 border border-slate-300 font-semibold text-slate-700 hover:bg-slate-50",children:"Басты бетке"})]})]})}export{ge as default};
//# sourceMappingURL=IntellectUp-C6qacPtl.js.map
