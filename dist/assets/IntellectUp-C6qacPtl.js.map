{"version":3,"file":"IntellectUp-C6qacPtl.js","sources":["../../src/api/quiz.js","../../src/pages/IntellectUp.jsx"],"sourcesContent":["// src/api/quiz.js\r\nimport { getJSON, postJSON } from \"./client\";\r\n\r\n/** Маршруты IQ-сервиса */\r\nexport const API = {\r\n  TESTS: \"/api/iq/tests\",\r\n  TEST_QUESTIONS: (id) => `/api/iq/tests/${id}/questions`,\r\n  ANSWER: \"/api/iq/answer\",\r\n  TEST_SUMMARY: (id) => `/api/iq/tests/${id}/summary`,\r\n};\r\n\r\n/** Валидаторы */\r\nconst ensureId = (name, v) => {\r\n  if (v == null || v === \"\" || Number.isNaN(Number(v))) {\r\n    throw new TypeError(`${name}: обязателен и должен быть числом/строкой ID`);\r\n  }\r\n  return v;\r\n};\r\nconst toLetter = (value) => {\r\n  const c = String(value ?? \"\").trim().toUpperCase();\r\n  if (![\"A\", \"B\", \"C\", \"D\"].includes(c)) {\r\n    throw new TypeError(\"chosen должен быть A/B/C/D\");\r\n  }\r\n  return c;\r\n};\r\n\r\n/** Список тестов */\r\nexport function fetchIQTests(opts = {}) {\r\n  return getJSON(API.TESTS, opts);\r\n}\r\n\r\n/** Вопросы теста */\r\nexport function fetchIQTestQuestions(testId, opts = {}) {\r\n  return getJSON(API.TEST_QUESTIONS(ensureId(\"fetchIQTestQuestions.testId\", testId)), opts);\r\n}\r\n\r\n/** Один ответ */\r\nexport function submitIQAnswer({ questionId, chosen }, opts = {}) {\r\n  const qid = ensureId(\"submitIQAnswer.questionId\", questionId);\r\n  const letter = toLetter(chosen);\r\n  return postJSON(API.ANSWER, { questionId: qid, chosen: letter }, opts);\r\n}\r\n\r\n/** Батч ответов (параллельно) */\r\nexport function submitIQAnswerBatch(answers = [], opts = {}) {\r\n  const jobs = (answers || []).map((a) => {\r\n    try {\r\n      const qid = ensureId(\"submitIQAnswerBatch[].questionId\", a?.questionId);\r\n      const letter = toLetter(a?.chosen);\r\n      return postJSON(API.ANSWER, { questionId: qid, chosen: letter }, opts);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }).filter(Boolean);\r\n  return Promise.allSettled(jobs);\r\n}\r\n\r\n/** Итог по тесту */\r\nexport function fetchIQTestSummary(testId, opts = {}) {\r\n  return getJSON(API.TEST_SUMMARY(ensureId(\"fetchIQTestSummary.testId\", testId)), opts);\r\n}\r\n\r\nconst quizApi = {\r\n  fetchIQTests,\r\n  fetchIQTestQuestions,\r\n  submitIQAnswer,\r\n  submitIQAnswerBatch,\r\n  fetchIQTestSummary,\r\n};\r\n\r\nexport default quizApi;\r\n","import React, { useEffect, useMemo, useState, useCallback, useRef } from \"react\";\r\nimport { motion } from \"framer-motion\";\r\nimport {\r\n  fetchIQTests,\r\n  fetchIQTestQuestions,\r\n  submitIQAnswer,\r\n  fetchIQTestSummary,\r\n} from \"../api/quiz\";\r\n\r\n/* ---------- Безопасная ссылка ---------- */\r\nfunction SmartLink({ to, className = \"\", children, ...rest }) {\r\n  let InRouter = null;\r\n  try { InRouter = require(\"react-router-dom\").useInRouterContext; } catch (_) {}\r\n  const inRouter = InRouter?.() ?? false;\r\n  if (!inRouter) return <a href={to} className={className} {...rest}>{children}</a>;\r\n  const { Link } = require(\"react-router-dom\");\r\n  return <Link to={to} className={className} {...rest}>{children}</Link>;\r\n}\r\n\r\nconst Pill = ({ children, active, onClick }) => (\r\n  <button\r\n    onClick={onClick}\r\n    className={`px-4 py-2 rounded-xl text-sm font-semibold border transition ${\r\n      active ? \"bg-slate-900 text-white border-slate-900\"\r\n             : \"bg-white text-slate-700 border-slate-300 hover:bg-slate-50\"\r\n    }`}\r\n  >\r\n    {children}\r\n  </button>\r\n);\r\n\r\nconst LS_KEY = \"intellect_up_stats_pure_api\";\r\nconst loadStats = () => { try { return JSON.parse(localStorage.getItem(LS_KEY) || \"{}\"); } catch { return {}; } };\r\nconst saveStats = (v) => localStorage.setItem(LS_KEY, JSON.stringify(v));\r\n\r\n/* ====== Нормализация ответа сервера /api/iq/tests/{id}/questions ====== */\r\nfunction normalizeIQFromServer(q) {\r\n  const options = [q.optionA, q.optionB, q.optionC, q.optionD].filter(Boolean);\r\n  return {\r\n    id: q.id,\r\n    q: q.prompt ?? \"\",\r\n    options, // порядок строго A,B,C,D\r\n    imageUrl: q.imageUrl || q.image || null,\r\n    domain: q.domain || null,\r\n    correctLetter: q.correct || null,\r\n  };\r\n}\r\nconst letterByIndex = (i) => [\"A\",\"B\",\"C\",\"D\"][i] ?? null;\r\nconst letterFromChoice = (normalizedQuestion, chosenText) => {\r\n  if (!normalizedQuestion || !Array.isArray(normalizedQuestion.options)) return null;\r\n  const idx = normalizedQuestion.options.findIndex((v) => v === chosenText);\r\n  return idx >= 0 ? letterByIndex(idx) : null;\r\n};\r\n\r\nexport default function IntellectUp() {\r\n  /* ======================= IQ ======================= */\r\n  const [tests, setTests] = useState([]);              // список доступных тестов\r\n  const [activeTestId, setActiveTestId] = useState(null);\r\n\r\n  const [iqBank, setIQBank] = useState([]);            // нормализованные вопросы текущего теста\r\n  const [iqTimeLimit, setIqTimeLimit] = useState(60);\r\n  const [iqLoading, setIqLoading] = useState(false);\r\n  const [iqError, setIqError] = useState(\"\");\r\n\r\n  const [started, setStarted] = useState(false);\r\n  const [step, setStep] = useState(0);\r\n  const [answers, setAnswers] = useState({});          // { questionIndex: optionText }\r\n  const [finished, setFinished] = useState(false);\r\n  const [timeLeft, setTimeLeft] = useState(60);\r\n\r\n  const [stats, setStats] = useState(() => loadStats());\r\n  const [questions, setQuestions] = useState([]);\r\n  const iqStartTs = useRef(null);\r\n\r\n  // Результат от сервера\r\n  const [iqSubmitting, setIqSubmitting] = useState(false);\r\n  const [iqSubmitErr, setIqSubmitErr] = useState(\"\");\r\n  const [iqServerRes, setIqServerRes] = useState(null); // {score,total,details}\r\n\r\n  // 1) Загрузка списка тестов\r\n  const loadIQ = useCallback(async () => {\r\n    setIqLoading(true); setIqError(\"\"); setIqServerRes(null);\r\n    try {\r\n      const list = await fetchIQTests();\r\n      setTests(Array.isArray(list) ? list : []);\r\n      setIqTimeLimit(60); // при необходимости можно присылать лимит с бэка\r\n      if (!activeTestId && Array.isArray(list) && list.length > 0) {\r\n        setActiveTestId(list[0].id);\r\n      }\r\n    } catch (e) {\r\n      setIqError(e?.message || \"Қате: тесттер тізімі жүктелмеді.\");\r\n    } finally {\r\n      setIqLoading(false);\r\n    }\r\n  }, [activeTestId]);\r\n  useEffect(() => { loadIQ(); }, [loadIQ]);\r\n\r\n  // 2) Старт: грузим вопросы выбранного теста\r\n  const start = async () => {\r\n    setIqSubmitErr(\"\"); setIqServerRes(null);\r\n    const testId = activeTestId ?? tests[0]?.id;\r\n    if (!testId) { setIqError(\"Тесттер жоқ.\"); return; }\r\n    try {\r\n      setIqLoading(true);\r\n      const rawQs = await fetchIQTestQuestions(testId);\r\n      const normalized = (Array.isArray(rawQs) ? rawQs : []).map(normalizeIQFromServer);\r\n      setIQBank(normalized);\r\n      setQuestions(normalized);\r\n      setStarted(true);\r\n      setStep(1);\r\n      setTimeLeft(iqTimeLimit);\r\n      setAnswers({});\r\n      setFinished(false);\r\n      iqStartTs.current = Date.now();\r\n      setActiveTestId(testId);\r\n    } catch (e) {\r\n      setIqError(e?.message || \"Сұрақтарды жүктеу қатесі.\");\r\n    } finally {\r\n      setIqLoading(false);\r\n    }\r\n  };\r\n\r\n  const restart = () => {\r\n    setStarted(false);\r\n    setStep(0);\r\n    setAnswers({});\r\n    setFinished(false);\r\n    setTimeLeft(iqTimeLimit);\r\n    setIqSubmitErr(\"\");\r\n    setIqServerRes(null);\r\n    iqStartTs.current = null;\r\n  };\r\n\r\n  // 3) Таймер\r\n  useEffect(() => {\r\n    if (!started || finished) return;\r\n    const id = setInterval(() => {\r\n      setTimeLeft((t) => {\r\n        if (t <= 1) { clearInterval(id); setFinished(true); return 0; }\r\n        return t - 1;\r\n      });\r\n    }, 1000);\r\n    return () => clearInterval(id);\r\n  }, [started, finished]);\r\n\r\n  // 4) Управление с клавиатуры\r\n  const handleKey = useCallback((e) => {\r\n    if (!started || finished || step === 0) return;\r\n    const currentIdx = step - 1;\r\n    const opts = questions[currentIdx]?.options || [];\r\n    if (e.key >= \"1\" && e.key <= \"4\") {\r\n      const i = Number(e.key) - 1;\r\n      if (opts[i]) setAnswers((prev) => ({ ...prev, [currentIdx]: opts[i] }));\r\n    }\r\n    if (e.key === \"Enter\") {\r\n      if (Object.prototype.hasOwnProperty.call(answers, currentIdx)) {\r\n        if (step < questions.length) setStep((s) => s + 1);\r\n        else setFinished(true);\r\n      }\r\n    }\r\n  }, [answers, finished, questions, started, step]);\r\n  useEffect(() => {\r\n    window.addEventListener(\"keydown\", handleKey);\r\n    return () => window.removeEventListener(\"keydown\", handleKey);\r\n  }, [handleKey]);\r\n\r\n  // 5) Локальный подсчёт (fallback)\r\n  const localScore = useMemo(() => 0, []); // сервер — источник истины\r\n\r\n  const selectOption = (qIndex, value) => setAnswers((prev) => ({ ...prev, [qIndex]: value }));\r\n  const next = () => (step < questions.length ? setStep(step + 1) : setFinished(true));\r\n  const prev = () => (step > 1 ? setStep(step - 1) : null);\r\n  const progressPct = step === 0 || !questions.length ? 0 : Math.round(((step - 1) / questions.length) * 100);\r\n  const timeColor = timeLeft > 30 ? \"text-emerald-600\" : timeLeft > 15 ? \"text-amber-600\" : \"text-rose-600\";\r\n\r\n  // 6) На завершении — отправляем ответы и берём summary\r\n  useEffect(() => {\r\n    if (!finished || !activeTestId) return;\r\n\r\n    // локальная статистика\r\n    const attempts = (stats.attempts || 0) + 1;\r\n    const best = Math.max(stats.best || 0, localScore);\r\n    const newStats = { attempts, best, last: localScore, lastAt: Date.now() };\r\n    setStats(newStats); saveStats(newStats);\r\n\r\n    (async () => {\r\n      setIqSubmitting(true); setIqSubmitErr(\"\");\r\n      try {\r\n        // Отправляем каждый ответ (letter A/B/C/D)\r\n        const sendables = questions.map((q, idx) => {\r\n          const chosen = answers[idx] ?? null;\r\n          const letter = letterFromChoice(q, chosen);\r\n          return letter ? submitIQAnswer({ questionId: q.id, chosen: letter }) : null;\r\n        }).filter(Boolean);\r\n        await Promise.allSettled(sendables);\r\n\r\n        // Забираем сводку\r\n        const s = await fetchIQTestSummary(activeTestId);\r\n        setIqServerRes({\r\n          score: Number(s?.correct ?? 0),\r\n          total: Number(s?.total ?? questions.length),\r\n          details: s,\r\n          message: \"Server summary\",\r\n        });\r\n      } catch (e) {\r\n        setIqSubmitErr(e?.message || \"Сервер нәтижесін алу мүмкін болмады.\");\r\n        setIqServerRes(null);\r\n      } finally {\r\n        setIqSubmitting(false);\r\n      }\r\n    })();\r\n  }, [finished, activeTestId]); // eslint-disable-line\r\n\r\n  /* ======================= Render ======================= */\r\n  const renderIQ = () => {\r\n    const totalFromServer = typeof iqServerRes?.total === \"number\" ? iqServerRes.total : questions.length;\r\n    const scoreFromServer = typeof iqServerRes?.score === \"number\" ? iqServerRes.score : localScore;\r\n\r\n    return (\r\n      <>\r\n        \r\n       \r\n\r\n        {/* Intro */}\r\n        {!started && !finished && step === 0 && (\r\n          <motion.div initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }} className=\"mt-6 text-center\">\r\n            <div className=\"mt-2 flex flex-col items-center gap-3\">\r\n              {iqLoading && <div className=\"text-sm text-slate-500\">Жүктелуде…</div>}\r\n              {iqError && (\r\n                <>\r\n                  <div className=\"text-sm text-rose-600\">{iqError}</div>\r\n                  <button onClick={loadIQ} className=\"rounded-xl px-4 py-2 border font-semibold\">Қайталап көру</button>\r\n                </>\r\n              )}\r\n\r\n              {/* Выбор теста */}\r\n              {!iqLoading && !iqError && tests.length > 0 && (\r\n                <div className=\"w-full max-w-xs text-left\">\r\n                  <label className=\"block text-sm text-slate-600 mb-1\">Тест таңдау</label>\r\n                  <select\r\n                    value={activeTestId ?? tests[0]?.id ?? \"\"}\r\n                    onChange={(e) => setActiveTestId(Number(e.target.value))}\r\n                    className=\"w-full rounded-xl border px-3 py-2\"\r\n                  >\r\n                    {tests.map((t) => (\r\n                      <option key={t.id} value={t.id}>{t.name}</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              )}\r\n\r\n              {!iqLoading && !iqError && (\r\n                <button\r\n                  onClick={start}\r\n                  disabled={!tests.length}\r\n                  className=\"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-[#1F7A8C] text-white font-semibold shadow hover:opacity-95 disabled:opacity-40\"\r\n                >\r\n                  Бастау\r\n                </button>\r\n              )}\r\n\r\n              {!iqLoading && !iqError && tests.length === 0 && (\r\n                <div className=\"text-sm text-slate-500\">Тесттер жоқ.</div>\r\n              )}\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n\r\n        {/* Progress + Timer */}\r\n        {started && !finished && (\r\n          <div className=\"mt-8\">\r\n            <div className=\"flex items-center justify-between text-sm text-slate-600 mb-2\">\r\n              <span>Сұрақ {step}/{questions.length}</span>\r\n              <span className={`font-semibold ${timeColor}`}>Қалған уақыт: {timeLeft} с</span>\r\n            </div>\r\n            <div className=\"w-full h-2 bg-slate-100 rounded-full overflow-hidden\">\r\n              <div className=\"h-2 bg-gradient-to-r from-[#1F7A8C] to-[#1aa6b5] transition-all\" style={{ width: `${progressPct}%` }} />\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Question */}\r\n        {started && !finished && step > 0 && questions.length > 0 && (\r\n          <motion.div key={step} initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }}\r\n            className=\"mt-6 rounded-2xl border border-slate-200 bg-white/80 backdrop-blur p-5 shadow\">\r\n            <h2 className=\"text-xl font-semibold text-slate-900\">{questions[step - 1].q}</h2>\r\n\r\n            {questions[step - 1].imageUrl ? (\r\n              <div className=\"mt-4 flex justify-center\">\r\n                <img\r\n                  src={questions[step - 1].imageUrl}\r\n                  alt={questions[step - 1].q?.slice(0, 120) ?? \"question image\"}\r\n                  className=\"max-h-48 w-auto rounded-lg object-contain border border-slate-200\"\r\n                />\r\n              </div>\r\n            ) : null}\r\n\r\n            <div className=\"mt-4 grid gap-3\">\r\n              {questions[step - 1].options.map((opt, i) => {\r\n                const checked = answers[step - 1] === opt;\r\n                return (\r\n                  <button\r\n                    key={`${questions[step - 1].id}-${i}`}\r\n                    onClick={() => selectOption(step - 1, opt)}\r\n                    className={`text-left rounded-xl border px-4 py-3 transition focus:outline-none focus:ring-2 focus:ring-sky-400 ${\r\n                      checked ? \"border-[#1F7A8C] bg-[#1F7A8C]/10\" : \"border-slate-200 hover:bg-slate-50\"\r\n                    }`}\r\n                    aria-pressed={checked}\r\n                  >\r\n                    <div className=\"flex items-center gap-3\">\r\n                      <span className={`inline-flex h-6 w-6 items-center justify-center rounded-full text-xs font-bold\r\n                        ${checked ? \"bg-[#1F7A8C] text-white\" : \"bg-slate-200 text-slate-700\"}`}>\r\n                        {i + 1}\r\n                      </span>\r\n                      <span>{opt}</span>\r\n                    </div>\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            <div className=\"mt-5 flex justify-between items-center\">\r\n              <button\r\n                onClick={prev}\r\n                disabled={step === 1}\r\n                className=\"inline-flex items-center justify-center rounded-xl px-4 py-2 border border-slate-300 font-medium text-slate-700 disabled:opacity-40\"\r\n              >\r\n                ⟵ Артқа\r\n              </button>\r\n\r\n              <div className=\"text-slate-500 text-sm hidden sm:block\">1–4 пернелерімен таңдауға болады</div>\r\n\r\n              <button\r\n                onClick={next}\r\n                disabled={!Object.prototype.hasOwnProperty.call(answers, step - 1)}\r\n                className=\"inline-flex items-center justify-center rounded-xl px-5 py-2.5 bg-slate-900 text-white font-medium disabled:opacity-40\"\r\n              >\r\n                {step < questions.length ? \"Келесі ⟶\" : \"Аяқтау\"}\r\n              </button>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n\r\n        {/* Result */}\r\n        {finished && (\r\n          <motion.div initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }}\r\n            className=\"mt-10 rounded-2xl border border-slate-200 bg-white/80 backdrop-blur p-6 shadow\">\r\n            <h3 className=\"text-2xl font-bold text-slate-900\">Нәтиже</h3>\r\n\r\n            {iqSubmitting && <p className=\"mt-2 text-slate-600 text-sm\">Серверден тексеру…</p>}\r\n            {iqSubmitErr && <p className=\"mt-2 text-rose-600 text-sm\">{iqSubmitErr}</p>}\r\n\r\n            <p className=\"mt-2 text-slate-700\">\r\n              Ұпай: <span className=\"font-semibold\">{scoreFromServer} / {totalFromServer}</span>\r\n              {iqServerRes?.message ? <span className=\"ml-2 text-slate-500 text-sm\">({iqServerRes.message})</span> : null}\r\n            </p>\r\n\r\n            {/* При желании можно отрисовать детали из iqServerRes.details */}\r\n\r\n            <div className=\"mt-6 grid sm:grid-cols-3 gap-3 text-sm\">\r\n              <div className=\"rounded-xl border p-4\">\r\n                <p className=\"text-slate-500\">Соңғы ұпай (локал)</p>\r\n                <p className=\"mt-1 font-semibold\">{localScore} / {questions.length}</p>\r\n              </div>\r\n              <div className=\"rounded-xl border p-4\">\r\n                <p className=\"text-slate-500\">Ең үздік нәтиже</p>\r\n                <p className=\"mt-1 font-semibold\">{Math.max(stats.best ?? 0, localScore)} / {questions.length}</p>\r\n              </div>\r\n              <div className=\"rounded-xl border p-4\">\r\n                <p className=\"text-slate-500\">Талпыныс саны</p>\r\n                <p className=\"mt-1 font-semibold\">{stats.attempts ?? 1}</p>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"mt-6 flex flex-wrap gap-3\">\r\n              <button onClick={start} className=\"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-slate-900 text-white font-semibold\">\r\n                Қайта өту\r\n              </button>\r\n              <button onClick={restart} className=\"inline-flex items-center justify-center rounded-xl px-5 py-3 border border-slate-300 font-semibold text-slate-700 hover:bg-slate-50\">\r\n                Басты экран\r\n              </button>\r\n            </div>\r\n          </motion.div>\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"container mx-auto max-w-5xl px-4 py-10\">\r\n      <motion.h1 initial={{ opacity: 0, y: 8 }} animate={{ opacity: 1, y: 0 }}\r\n        className=\"text-3xl md:text-4xl font-extrabold text-slate-900 text-center\">\r\n        IntellectUp — Danalyq Challenge (IQ)\r\n      </motion.h1>\r\n      \r\n\r\n      <div className=\"mt-8\">{renderIQ()}</div>\r\n\r\n      <div className=\"mt-8 flex flex-wrap gap-3 justify-center\">\r\n        <SmartLink to=\"/realtalk\" className=\"inline-flex items-center justify-center rounded-xl px-5 py-3 bg-[#1aa6b5] text-white font-semibold shadow hover:opacity-95\">\r\n          RealTalkTime (EQ)\r\n        </SmartLink>\r\n        <SmartLink to=\"/\" className=\"inline-flex items-center justify-center rounded-xl px-5 py-3 border border-slate-300 font-semibold text-slate-700 hover:bg-slate-50\">\r\n          Басты бетке\r\n        </SmartLink>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["API","id","ensureId","name","v","toLetter","value","c","fetchIQTests","opts","getJSON","fetchIQTestQuestions","testId","submitIQAnswer","questionId","chosen","qid","letter","postJSON","fetchIQTestSummary","SmartLink","to","className","children","rest","InRouter","jsx","Link","LS_KEY","loadStats","saveStats","normalizeIQFromServer","q","options","letterByIndex","i","letterFromChoice","normalizedQuestion","chosenText","idx","IntellectUp","tests","setTests","useState","activeTestId","setActiveTestId","iqBank","setIQBank","iqTimeLimit","setIqTimeLimit","iqLoading","setIqLoading","iqError","setIqError","started","setStarted","step","setStep","answers","setAnswers","finished","setFinished","timeLeft","setTimeLeft","stats","setStats","questions","setQuestions","iqStartTs","useRef","iqSubmitting","setIqSubmitting","iqSubmitErr","setIqSubmitErr","iqServerRes","setIqServerRes","loadIQ","useCallback","list","e","useEffect","start","rawQs","normalized","restart","t","handleKey","currentIdx","prev","s","localScore","useMemo","selectOption","qIndex","next","progressPct","timeColor","attempts","best","newStats","sendables","renderIQ","totalFromServer","scoreFromServer","jsxs","Fragment","motion","opt","checked"],"mappings":"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"}