import{R as c,j as e,m as X}from"./index-CVxrc5Ku.js";import{g as I,p as Z}from"./client-DYrIeA2N.js";const A={BOOKS:"/api/sq/books",BOOK_QUESTIONS:t=>`/api/sq/books/${t}/questions`,ANSWER:"/api/sq/answer",SUMMARY:t=>`/api/sq/books/${t}/summary`},U=["A","B","C","D"],W=t=>typeof t=="number"&&t>=0&&t<U.length?U[t]:null,ee=t=>{const l=String(t??"").trim().toUpperCase();if(!U.includes(l))throw new TypeError("chosen –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å A/B/C/D");return l},L=(t,l)=>{if(l==null||l===""||Number.isNaN(Number(l)))throw new TypeError(`${t}: –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º/—Å—Ç—Ä–æ–∫–æ–π ID`);return l};async function se(t={}){const l=await I(A.BOOKS,t);return Array.isArray(l)?l:[]}async function te(t,l={}){const x=L("fetchSQBookQuestions.bookId",t),j=await I(A.BOOK_QUESTIONS(x),l);return(Array.isArray(j)?j:[]).map(n=>({id:n.id,book:n.book,prompt:n.prompt,options:[n.optionA,n.optionB,n.optionC,n.optionD].filter(w=>w!=null),imageUrl:n.imageUrl||n.image||null,domain:n.domain||null,correctLetter:n.correct||null}))}async function re({questionId:t,chosen:l},x={}){const j=L("submitSQAnswer.questionId",t),n=ee(l);return Z(A.ANSWER,{questionId:j,chosen:n},x)}async function le(t,l={}){const x=L("fetchSQSummary.bookId",t);return I(A.SUMMARY(x),l)}const ae=({value:t})=>e.jsx("div",{className:"w-full bg-slate-200/70 rounded-full h-2.5 overflow-hidden",children:e.jsx("div",{className:"h-2.5 rounded-full bg-gradient-to-r from-[#1F7A8C] via-[#1aa6b5] to-[#0ea5a5]",style:{width:`${t}%`}})}),Y=({ok:t})=>e.jsx("span",{className:`ml-2 inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs ${t?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:t?"–î“±—Ä—ã—Å":"–ë“±—Ä—ã—Å"});function ce(){const[t,l]=c.useState([]),[x,j]=c.useState(!1),[n,w]=c.useState(""),[u,B]=c.useState(null),[d,R]=c.useState([]),[M,T]=c.useState(!1),[Q,z]=c.useState(""),[N,k]=c.useState("catalog"),[i,f]=c.useState(0),[b,C]=c.useState({}),[D,v]=c.useState({}),[F,K]=c.useState(!1),[y,S]=c.useState(null),[O,E]=c.useState(""),P=async()=>{j(!0),w("");try{const s=await se();l(Array.isArray(s)?s:[])}catch(s){w(s?.message||"–ö—ñ—Ç–∞–ø—Ç–∞—Ä —Ç—ñ–∑—ñ–º—ñ –∂“Ø–∫—Ç–µ–ª–º–µ–¥—ñ.")}finally{j(!1)}};c.useEffect(()=>{P()},[]);const _=async s=>{B(s),k("quiz"),f(0),C({}),v({}),S(null),E(""),T(!0),z("");try{const o=await te(s.id);R(o)}catch(o){z(o?.message||"–°“±—Ä–∞“õ—Ç–∞—Ä –∂“Ø–∫—Ç–µ–ª–º–µ–¥—ñ."),k("catalog"),B(null)}finally{T(!1)}},q=async(s,o)=>{if(!d[s])return;const r=d[s],a=W(o);if(a){C(h=>({...h,[r.id]:a})),K(!0);try{const g=!!(await re({questionId:r.id,chosen:a}))?.correct;v($=>({...$,[r.id]:{correct:g}}))}catch(h){v(g=>({...g,[r.id]:{correct:!1,error:h?.message}}))}finally{K(!1)}}};c.useEffect(()=>{if(N!=="quiz")return;const s=o=>{if(d[i]){if(o.key>="1"&&o.key<="4"){const r=Number(o.key)-1;d[i]?.options?.[r]!=null&&q(i,r)}else if(o.key==="Enter"){const r=d[i]?.id;r&&b[r]&&i<d.length-1&&f(a=>a+1)}}};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[N,i,d,b]);const H=async()=>{if(u){k("result"),S(null),E("");try{const s=await le(u.id),o=Number(s?.total??d.length)||d.length||0,r=Number(s?.correct??s?.score??0)||0,a=Number(s?.points??r)||0;S({total:o,correct:r,points:a})}catch(s){E(s?.message||"“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã–Ω—ã –∞–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.")}}},J=()=>{B(null),R([]),k("catalog"),f(0),C({}),v({}),S(null),E("")},m=d[i],p=d.length,G=p?Math.round((i+1)/p*100):0;return e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 py-10",children:[e.jsxs(X.h1,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"text-3xl md:text-4xl font-extrabold text-slate-900",children:["Abai Insight (SQ) ‚Äî ",e.jsx("span",{className:"text-[#f59e0b]",children:"Server-based Quiz"})]}),e.jsxs("p",{className:"mt-2 text-slate-600",children:["–ë–∞—Ä–ª—ã“õ —Å“±—Ä–∞“õ—Ç–∞—Ä –º–µ–Ω —Ç–µ–∫—Å–µ—Ä—É ‚Äî ",e.jsx("b",{children:"—Å–µ—Ä–≤–µ—Ä–¥–µ–Ω"}),". –¢–∞“£–¥–∞“ì–∞–Ω –∂–∞—É–∞–±—ã“£—ã–∑ ”ô—Ä —Å“±—Ä–∞“õ—Ç–∞ –±—ñ—Ä–¥–µ–Ω –∂—ñ–±–µ—Ä—ñ–ª–µ–¥—ñ."]}),N==="catalog"&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[e.jsx("button",{onClick:P,disabled:x,className:"rounded-xl border px-3 py-2 text-sm font-semibold hover:bg-slate-50 disabled:opacity-40",children:x?"–ñ“Ø–∫—Ç–µ–ª—É–¥–µ‚Ä¶":"“ö–∞–π—Ç–∞ –∂“Ø–∫—Ç–µ—É"}),n&&e.jsx("span",{className:"text-sm text-rose-600",children:n})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[t.map(s=>e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 shadow",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-12 h-12 rounded-xl object-cover border"}):e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gradient-to-r from-amber-100 to-orange-100 flex items-center justify-center text-xl",children:"üìò"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:s.title}),e.jsx("p",{className:"text-xs text-slate-500",children:s.author})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>_(s),className:"rounded-xl bg-sky-600 text-white px-4 py-2 text-sm font-semibold",children:"–¢–µ—Å—Ç—Ç—ñ –±–∞—Å—Ç–∞—É"})})]},s.id)),!x&&!n&&t.length===0&&e.jsx("div",{className:"rounded-xl border p-4 text-slate-500",children:"–ö—ñ—Ç–∞–ø—Ç–∞—Ä –∂–æ“õ."})]})]}),N==="quiz"&&e.jsxs("div",{className:"mt-6 rounded-2xl border border-slate-200 bg-white/80 p-5 shadow",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[u?.imageUrl?e.jsx("img",{src:u.imageUrl,alt:u?.title,className:"w-12 h-12 rounded-xl object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-xl bg-sky-100 flex items-center justify-center text-xl",children:"üìñ"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"text-xl font-bold text-slate-900",children:u?.title}),e.jsx("p",{className:"text-xs text-slate-500",children:u?.author})]}),e.jsx("button",{onClick:J,className:"ml-auto rounded-xl border px-3 py-2 text-sm font-semibold",children:"–ö—ñ—Ç–∞–ø—Ç–∞—Ä“ì–∞ –æ—Ä–∞–ª—É"})]}),M&&e.jsx("p",{className:"mt-4 text-sm text-slate-500",children:"–°“±—Ä–∞“õ—Ç–∞—Ä –∂“Ø–∫—Ç–µ–ª—É–¥–µ‚Ä¶"}),Q&&e.jsx("div",{className:"mt-4 text-sm text-rose-600",children:Q}),!M&&!Q&&p>0&&m&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4",children:[e.jsx(ae,{value:G}),e.jsxs("div",{className:"mt-2 flex justify-between text-xs text-slate-500",children:[e.jsxs("span",{children:["–°“±—Ä–∞“õ ",i+1," / ",p]}),F&&e.jsx("span",{children:"–ñ—ñ–±–µ—Ä—ñ–ª—É–¥–µ‚Ä¶"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-lg font-bold text-slate-900",children:m.prompt}),m.imageUrl?e.jsx("div",{className:"mt-3 flex justify-center",children:e.jsx("img",{src:m.imageUrl,alt:m.prompt?.slice(0,120)||"question image",className:"max-h-48 w-auto rounded-lg object-contain border border-slate-200"})}):null,e.jsx("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:m.options.map((s,o)=>{const r=W(o),a=b[m.id]===r,h=D[m.id],g=!!h,$=h?.correct===!0&&a,V=g&&a&&!h?.correct;return e.jsx("button",{onClick:()=>q(i,o),className:`text-left rounded-xl border-2 p-4 transition ${a?"border-sky-600 bg-sky-50":"border-slate-200 hover:border-sky-300 hover:bg-sky-50/40"} ${V?"border-rose-300 bg-rose-50/50":""} ${$?"border-emerald-300 bg-emerald-50/60":""}`,disabled:F,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`mt-0.5 h-2.5 w-2.5 rounded-full ${a?"bg-sky-600":"bg-slate-300"}`}),e.jsxs("span",{className:"text-slate-800",children:[e.jsxs("b",{children:[r,")"]})," ",s]}),g&&a&&e.jsx(Y,{ok:!!h?.correct})]})},`${m.id}-${r}`)})})]}),e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsx("button",{onClick:()=>f(s=>Math.max(0,s-1)),disabled:i===0,className:`rounded-xl px-4 py-2 font-semibold border ${i===0?"text-slate-400 border-slate-200 cursor-not-allowed":"border-slate-300"}`,children:"‚üµ –ê—Ä—Ç“õ–∞"}),i<p-1?e.jsx("button",{onClick:()=>f(s=>Math.min(p-1,s+1)),disabled:!b[m.id],className:`rounded-xl px-4 py-2 font-semibold ${b[m.id]?"bg-sky-600 text-white":"bg-slate-200 text-slate-500 cursor-not-allowed"}`,children:"–ö–µ–ª–µ—Å—ñ ‚ü∂"}):e.jsx("button",{onClick:H,disabled:Object.keys(b).length<p,className:`rounded-xl px-4 py-2 font-semibold ${Object.keys(b).length<p?"bg-slate-200 text-slate-500 cursor-not-allowed":"bg-emerald-600 text-white"}`,children:"–¢–∞–ø—Å—ã—Ä—É ‚úì"})]}),e.jsx("p",{className:"mt-2 text-xs text-slate-500",children:"–ö–µ“£–µ—Å: 1‚Äì4 –ø–µ—Ä–Ω–µ–ª–µ—Ä—ñ–º–µ–Ω –∂–∞—É–∞–ø—Ç—ã —Ç–∞“£–¥–∞—É“ì–∞, Enter ‚Äî –∫–µ–ª–µ—Å—ñ–≥–µ ”©—Ç—É–≥–µ –±–æ–ª–∞–¥—ã."})]})]}),N==="result"&&e.jsxs("div",{className:"mt-8 rounded-2xl border border-slate-200 bg-white p-6 shadow",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-100 flex items-center justify-center text-xl",children:"üéâ"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-900",children:["–ù”ô—Ç–∏–∂–µ ‚Äî ",u?.title]}),e.jsx("p",{className:"text-xs text-slate-500",children:u?.author})]}),e.jsx("button",{onClick:J,className:"ml-auto rounded-xl border px-3 py-2 text-sm font-semibold",children:"–ö—ñ—Ç–∞–ø—Ç–∞—Ä“ì–∞ –æ—Ä–∞–ª—É"})]}),!y&&!O&&e.jsx("p",{className:"mt-3 text-sm text-slate-500",children:"“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã –∂“Ø–∫—Ç–µ–ª—É–¥–µ‚Ä¶"}),O&&e.jsx("p",{className:"mt-3 text-sm text-rose-600",children:O}),y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-4 grid sm:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("p",{className:"text-slate-500",children:"–ñ–∞–ª–ø—ã —Å“±—Ä–∞“õ"}),e.jsx("p",{className:"mt-1 font-semibold",children:y.total})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("p",{className:"text-slate-500",children:"–î“±—Ä—ã—Å—ã"}),e.jsx("p",{className:"mt-1 font-semibold",children:y.correct})]}),e.jsxs("div",{className:"rounded-xl border p-4",children:[e.jsx("p",{className:"text-slate-500",children:"“∞–ø–∞–π"}),e.jsx("p",{className:"mt-1 font-semibold",children:y.points})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"–¢–∞“£–¥–∞–ª“ì–∞–Ω –∂–∞—É–∞–ø—Ç–∞—Ä"}),e.jsx("div",{className:"mt-3 grid gap-3",children:d.map((s,o)=>{const r=b[s.id],a=D[s.id];return e.jsx("div",{className:"rounded-xl border p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("span",{className:"mt-0.5 text-sm font-semibold text-slate-500",children:[o+1,"."]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-slate-900",children:[s.prompt," ",a?e.jsx(Y,{ok:!!a?.correct}):null]}),e.jsxs("p",{className:"mt-1 text-sm",children:["–¢–∞“£–¥–∞–ª“ì–∞–Ω: ",e.jsx("b",{children:r??"‚Äî"}),s.correctLetter?e.jsxs(e.Fragment,{children:[" ","| –î“±—Ä—ã—Å:"," ",e.jsx("b",{className:"text-emerald-700",children:s.correctLetter})]}):null]}),a?.error&&e.jsx("p",{className:"mt-1 text-xs text-rose-600",children:a.error})]})]})},s.id)})})]})]})]})]})}export{ce as default};
//# sourceMappingURL=ThinkHub-ZEhFWtNv.js.map
