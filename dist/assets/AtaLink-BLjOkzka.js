import{R as i,j as e,m as le}from"./index-CVxrc5Ku.js";import{g as I,p as re}from"./client-DYrIeA2N.js";const w={ARTICLES:"/api/atalink/articles",ARTICLE:l=>`/api/atalink/articles/${l}`,QUESTIONS:l=>`/api/atalink/articles/${l}/questions`,ANSWER:"/api/atalink/answer",SUMMARY:l=>`/api/atalink/articles/${l}/summary`},E=(l,a)=>{if(a==null||a===""||Number.isNaN(Number(a)))throw new TypeError(`${l}: обязателен и должен быть числом/строкой ID`);return a},R=["A","B","C","D"],ne=l=>R[l]??null,W=l=>{const a=String(l??"").trim().toUpperCase();if(!R.includes(a))throw new TypeError("chosen должен быть A/B/C/D");return a};async function ie(l={}){try{const a=await I(w.ARTICLES,l);if(Array.isArray(a)&&a.length>0)return a}catch(a){throw a}return[]}async function ce(l,a={}){const c=E("fetchAtaArticle.articleId",l);return I(w.ARTICLE(c),a)}async function oe(l,a={}){const c=E("fetchAtaArticleQuestions.articleId",l),b=await I(w.QUESTIONS(c),a);return(Array.isArray(b)?b:[]).map(n=>({id:n.id,prompt:n.prompt??"",options:[n.optionA,n.optionB,n.optionC,n.optionD].filter(Boolean),correctLetter:n.correct??null,article:n.article}))}async function de({questionId:l,chosen:a},c={}){const b=E("submitAtaAnswer.questionId",l),n=W(a);return re(w.ANSWER,{questionId:b,chosen:n},c)}async function me(l,a={}){const c=E("fetchAtaArticleSummary.articleId",l);return I(w.SUMMARY(c),a)}const ue={toLetterByIndex:ne,toLetter:W,LETTERS:R},J="atalink_quiz_stats_v1",K="atalink_active_tab_v1",T="atalink_active_article_v1";function _(l,a){try{return JSON.parse(localStorage.getItem(l)||"null")??a}catch{return a}}function A(l,a){localStorage.setItem(l,JSON.stringify(a))}function xe(l){try{const a=new URL(l);if(a.hostname.includes("youtube.com")){const c=a.searchParams.get("v");if(c)return`https://www.youtube.com/embed/${c}`}if(a.hostname==="youtu.be"){const c=a.pathname.slice(1);if(c)return`https://www.youtube.com/embed/${c}`}}catch{}return null}function he(l=""){let a=String(l||"");return a=a.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\n/g,"<br/>"),a}const be=[{title:"1) Сүйіспеншілік пен қолдау",bullets:["«Сен маған маңыздысың», «Саған сенемін» деп күн сайын айту.","Іс-әрекетпен көрсету: уақыт бөлу, бірге ойнау.","Баланы емес, әрекетін талқылау: «Бұл ісің дұрыс болмады»."]}],pe=["https://www.youtube.com/watch?v=BcusHhHa3DE","https://www.youtube.com/watch?v=Ph4V60tlf4o","https://www.youtube.com/watch?v=4sXBoarWHbA","https://www.youtube.com/watch?v=iC1X6dGuARY"],fe=[],u=[];function ve(){const[l,a]=i.useState(()=>_(K,"tips"));i.useEffect(()=>A(K,l),[l]);const[c,b]=i.useState([]),[n,z]=i.useState(()=>_(T,null)),[N,L]=i.useState(null),[F,Q]=i.useState(!1),[B,$]=i.useState(""),[m,k]=i.useState([]),[q,M]=i.useState(!1),[U,C]=i.useState(""),[o,p]=i.useState(0),[j,y]=i.useState({}),[v,V]=i.useState(()=>_(J,{attempts:0,best:0,last:0})),d=m.length>0||n!=null,x=d?m.length:u.length,g=Object.entries(j).reduce((t,[s,r])=>t+(u[+s]?.correct===r?1:0),0),[X,O]=i.useState(!1),[Y,h]=i.useState(null),[D,S]=i.useState("");i.useEffect(()=>{let t=!1;return(async()=>{Q(!0),$("");try{const s=await ie();if(t)return;b(s);const r=n??s[0]?.id??null;z(r),r&&A(T,r)}catch(s){if(t)return;$(s?.message||"Мақалалар жүктелмеді (құқық/желіні тексеріңіз).")}finally{t||Q(!1)}})(),()=>{t=!0}},[]),i.useEffect(()=>{let t=!1;if(!n){L(null),k([]);return}return(async()=>{C(""),h(null);try{const s=await ce(n);if(t)return;L(s)}catch(s){if(t)return;L(null),C(s?.message||"Мақала алынбады.")}try{M(!0);const s=await oe(n);if(t)return;k(s)}catch(s){if(t)return;k([]),C(s?.message||"Сұрақтар жүктелмеді.")}finally{t||M(!1)}})(),()=>{t=!0}},[n]);const P=()=>{p(1),y({}),h(null),S("")},Z=(t,s)=>y(r=>({...r,[t]:s})),G=()=>{o<x?p(o+1):te()},ee=()=>{p(0),y({}),h(null),S("")};async function te(){if(p(x+1),!d){const t=(v.attempts||0)+1,s=Math.max(v.best||0,g),r={attempts:t,best:s,last:g,lastAt:Date.now()};V(r),A(J,r);return}if(!(!n||m.length===0)){O(!0),S(""),h(null);try{const t=m.map((r,f)=>{const ae=j[f],H=ue.toLetterByIndex(ae);return H?de({questionId:r.id,chosen:H}):null}).filter(Boolean);await Promise.allSettled(t);const s=await me(n);h({total:Number(s?.total??m.length),correct:Number(s?.correct??0)})}catch(t){S(t?.message||"Серверлік қорытындыны алу мүмкін болмады."),h(null)}finally{O(!1)}}}const se=pe.map(xe).filter(Boolean);return e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 py-10",children:[e.jsxs(le.h1,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"text-3xl md:text-4xl font-extrabold text-slate-900",children:["AtaLink — ",e.jsx("span",{className:"text-[#f59e0b]",children:"Ата-анамен байланыс (кеңес/тест/видео/заң)"})]}),e.jsx("p",{className:"mt-2 text-slate-600",children:"Мақалалар мен тесттер енді серверден жүктеледі. Қажет болса — локалдық режимге автоматты түрде ауысады."}),e.jsx("div",{className:"mt-6 flex flex-wrap gap-2",children:[["tips","Кеңестер"],["quiz","Тест (мақала)"],["videos","Видеолар"],["laws","Заңнама"]].map(([t,s])=>e.jsx("button",{onClick:()=>a(t),className:`px-3 py-2 rounded-xl border text-sm font-semibold ${l===t?"bg-amber-500 text-white border-amber-500":"border-slate-300"}`,children:s},t))}),l==="tips"&&e.jsx("div",{className:"mt-6 grid gap-4",children:e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:"Ата-аналарға арналған кеңестер (ТОП-10)"}),e.jsx("div",{className:"mt-3 grid md:grid-cols-2 gap-3",children:be.map(t=>e.jsxs("div",{className:"rounded-xl border border-slate-200 p-3",children:[e.jsx("div",{className:"font-semibold text-slate-900",children:t.title}),e.jsx("ul",{className:"mt-2 list-disc pl-5 text-sm text-slate-700 space-y-1",children:t.bullets.map((s,r)=>e.jsx("li",{children:s},r))})]},t.title))})]})}),l==="quiz"&&e.jsxs("div",{className:"mt-6 rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:"Тест: мақаланы таңдаңыз да, сұрақтарға жауап беріңіз"}),e.jsxs("div",{className:"mt-3 grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-slate-600 mb-1",children:"Мақала"}),e.jsxs("select",{value:n??"",onChange:t=>{const s=t.target.value?Number(t.target.value):null;z(s),A(T,s),p(0),y({}),h(null)},className:"w-full rounded-xl border px-3 py-2",children:[e.jsx("option",{value:"",children:"— таңдалмаған —"}),c.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]}),F&&e.jsx("div",{className:"mt-1 text-sm text-slate-500",children:"Мақалалар жүктелуде…"}),B&&e.jsx("div",{className:"mt-1 text-sm text-rose-600",children:B})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 p-3",children:[e.jsx("div",{className:"text-sm text-slate-600",children:"Қысқаша"}),e.jsx("div",{className:"mt-1 text-slate-900 font-medium",children:N?.title||"—"}),N?.summary&&e.jsx("div",{className:"mt-1 text-sm text-slate-700",children:N.summary})]})]}),N?.contentMarkdown&&e.jsxs("div",{className:"mt-4 rounded-xl border border-slate-200 p-3 bg-white",children:[e.jsx("div",{className:"text-sm text-slate-600 mb-1",children:"Мазмұны"}),e.jsx("div",{className:"prose prose-sm max-w-none text-slate-800",dangerouslySetInnerHTML:{__html:he(N.contentMarkdown)}})]}),o===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"text-slate-600 text-sm",children:d?"Мақаланы таңдағаннан кейін «Тесті бастау» батырмасын басыңыз.":"Сервер қолжетімсіз — локалдық тестке ауыстық."}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-3 text-sm text-slate-600",children:[e.jsxs("div",{className:"rounded-xl border p-3",children:["Соңғы ұпай: ",e.jsx("b",{children:v.last??0})," / ",u.length]}),e.jsxs("div",{className:"rounded-xl border p-3",children:["Ең үздік нәтиже: ",e.jsx("b",{children:v.best??0})," / ",u.length]}),e.jsxs("div",{className:"rounded-xl border p-3",children:["Талпыныс саны: ",e.jsx("b",{children:v.attempts??0})]})]}),e.jsx("button",{onClick:P,disabled:d&&(!n||q||m.length===0),className:"mt-3 px-4 py-2 rounded-xl bg-amber-500 text-white font-semibold disabled:opacity-40",children:"Тесті бастау"}),U&&e.jsx("div",{className:"mt-2 text-sm text-rose-600",children:U})]}),o>0&&o<=x&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"text-sm text-slate-600",children:["Сұрақ ",o,"/",x]}),e.jsx("div",{className:"mt-2 font-semibold text-slate-900",children:d?m[o-1]?.prompt||"":u[o-1].q}),e.jsx("div",{className:"mt-3 grid gap-2",children:(d?m[o-1]?.options||[]:u[o-1].options).map((t,s)=>{const r=j[o-1]===s;return e.jsx("button",{onClick:()=>Z(o-1,s),className:`text-left rounded-xl border px-4 py-3 transition ${r?"border-amber-500 bg-amber-50":"border-slate-200 hover:bg-slate-50"}`,children:t},s)})}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{onClick:()=>p(t=>Math.max(1,t-1)),className:"px-4 py-2 rounded-xl border border-slate-300 font-semibold",children:"Артқа"}),e.jsx("button",{onClick:G,disabled:!(o-1 in j),className:"px-4 py-2 rounded-xl bg-slate-900 text-white font-semibold disabled:opacity-40",children:o<x?"Келесі":"Нәтижені көру"})]})]}),o===x+1&&e.jsxs("div",{className:"mt-4",children:[d?e.jsxs(e.Fragment,{children:[X&&e.jsx("div",{className:"text-sm text-slate-600",children:"Серверден тексеру…"}),D&&e.jsx("div",{className:"text-sm text-rose-600",children:D}),e.jsxs("div",{className:"text-xl font-bold text-slate-900",children:["Нәтиже: ",Y?.correct??0," / ",Y?.total??x]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-xl font-bold text-slate-900",children:["Нәтиже: ",g," / ",u.length]}),e.jsx("p",{className:"mt-1 text-slate-700",children:g<=4?"Базалық түсініктер қалыптасқан. Кеңестерді қарап шығыңыз.":g<=8?"Жақсы! Тыңдау мен сенімге мән беріңіз.":"Керемет! Үлгілік тәрбие — осы қарқынмен жалғастырыңыз."})]}),!d&&e.jsx("div",{className:"mt-4 grid gap-3",children:u.map((t,s)=>{const r=j[s],f=r===t.correct;return e.jsxs("div",{className:`rounded-xl border p-3 ${f?"border-emerald-200 bg-emerald-50/60":"border-rose-200 bg-rose-50/60"}`,children:[e.jsx("div",{className:"font-medium text-slate-900",children:t.q}),e.jsxs("div",{className:"mt-1 text-sm",children:["Таңдалған: ",e.jsx("b",{className:f?"text-emerald-700":"text-rose-700",children:r!=null?t.options[r]:"—"})," ","| Дұрыс: ",e.jsx("b",{className:"text-emerald-700",children:t.options[t.correct]})]})]},s)})}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{onClick:P,className:"px-4 py-2 rounded-xl bg-amber-500 text-white font-semibold",children:"Қайта өту"}),e.jsx("button",{onClick:ee,className:"px-4 py-2 rounded-xl border border-slate-300 font-semibold",children:"Басты экран"})]})]})]}),l==="videos"&&e.jsxs("div",{className:"mt-6 rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:"Бала тәрбиесі туралы видеолар"}),e.jsx("div",{className:"mt-3 grid md:grid-cols-2 gap-4",children:se.map((t,s)=>e.jsx("div",{className:"rounded-xl overflow-hidden border border-slate-200 bg-black/5 aspect-video",children:e.jsx("iframe",{title:`video-${s}`,src:t,className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})},s))}),e.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"Ескерту: Видеолар YouTube платформасынан ендірілді."})]}),l==="laws"&&e.jsxs("div",{className:"mt-6 grid gap-4",children:[e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("h3",{className:"font-bold text-slate-900",children:"Ата-ана міндеттері туралы заңнамалар (қысқаша)"}),e.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Бұл бөлім ақпараттық сипатта. Нақты жағдайға қатысты ресми дереккөздер мен маманға жүгініңіз."}),e.jsx("div",{className:"mt-3 space-y-3",children:fe.map((t,s)=>e.jsxs("details",{className:"rounded-xl border border-slate-200 p-3",children:[e.jsx("summary",{className:"cursor-pointer font-semibold text-slate-900",children:t.title}),e.jsx("ul",{className:"mt-2 list-disc pl-5 text-sm text-slate-700 space-y-1",children:t.points.map((r,f)=>e.jsx("li",{children:r},f))})]},s))})]}),e.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-4",children:[e.jsx("h4",{className:"font-semibold text-slate-900",children:"Ескерту"}),e.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Айыппұл мөлшерлері АЕК-ке (айлық есептік көрсеткіш) байланған. АЕК жыл сайын өзгеруі мүмкін."})]})]})]})}export{ve as default};
//# sourceMappingURL=AtaLink-BLjOkzka.js.map
