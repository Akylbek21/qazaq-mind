import{R as o,j as e,m as q}from"./index-CVxrc5Ku.js";import{g as E,p as R}from"./client-DYrIeA2N.js";const j={TASKS:"/api/pq/tasks",ANSWER:"/api/pq/answer",SUMMARY:"/api/pq/summary",TOGGLE_TASK:s=>`/api/pq/tasks/${s}/toggle`,TASK_STATUS:s=>`/api/pq/tasks/${s}/status`,TOGGLE_FALLBACK:"/api/pq/toggle"},O=(s,n)=>{if(n==null||n===""||Number.isNaN(Number(n)))throw new TypeError(`${s}: обязателен и должен быть числом/строкой ID`);return n};async function F(s={}){const n=await E(j.TASKS,s);return Array.isArray(n)?n:[]}async function $({taskId:s,done:n=void 0,status:r=void 0},c={}){const h=O("togglePQTask.taskId",s),f={done:typeof n=="boolean"?n:void 0,status:r||(typeof n=="boolean"?n?"DONE":"OPEN":void 0)},N=[{path:j.TOGGLE_TASK(h),body:{done:f.done}},{path:j.TASK_STATUS(h),body:{status:f.status}},{path:j.TOGGLE_FALLBACK,body:{taskId:h,done:f.done}}];let b;for(const d of N)try{if(d.body&&Object.values(d.body).every(g=>g===void 0))continue;return await R(d.path,d.body,c)}catch(m){b=m}throw b||new Error("togglePQTask: ни один из вариантов маршрута не сработал")}const w="lifecharge_state_v1",p=()=>{const s=new Date,n=s.getFullYear(),r=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0");return`${n}-${r}-${c}`},k={date:p(),focusMinutes:25,breakMinutes:5,timerMode:"focus",timerRunning:!1,timerLeftSec:1500,sessionsDoneToday:0,sessionsDoneTotal:0,waterTarget:8,waterCups:0,bedtime:"22:30",wakeTime:"06:30",eveningDnd:!0,checklist:{morningNoPhone:!1,eveningNoPhone:!1,walk:!1,stretch:!1}};function K(){try{const s=JSON.parse(localStorage.getItem(w)||"null");return s?s.date!==p()?{...s,date:p(),timerMode:"focus",timerRunning:!1,timerLeftSec:(s.focusMinutes||25)*60,sessionsDoneToday:0,waterCups:0,checklist:{morningNoPhone:!1,eveningNoPhone:!1,walk:!1,stretch:!1}}:{...k,...s}:k}catch{return k}}const _=s=>localStorage.setItem(w,JSON.stringify(s)),B=s=>`${Math.floor(s/60).toString().padStart(2,"0")}:${Math.floor(s%60).toString().padStart(2,"0")}`,G=s=>{const[n,r]=s.split(":").map(Number),c=new Date;return c.setHours(n,r,0,0),c},u=s=>{const n=G(s).getTime();let r=Math.floor((n-Date.now())/6e4);return r<0&&(r+=1440),r};function U(){const[s,n]=o.useState(K);o.useEffect(()=>_(s),[s]),o.useEffect(()=>{if(!s.timerRunning)return;const t=setInterval(()=>{n(a=>{const l=a.timerLeftSec-1;if(l>0)return{...a,timerLeftSec:l};if(a.timerMode==="focus"){const i=Math.max(1,a.breakMinutes)*60;return{...a,timerMode:"break",timerRunning:!1,timerLeftSec:i,sessionsDoneToday:a.sessionsDoneToday+1,sessionsDoneTotal:a.sessionsDoneTotal+1}}else{const i=Math.max(1,a.focusMinutes)*60;return{...a,timerMode:"focus",timerRunning:!1,timerLeftSec:i}}})},1e3);return()=>clearInterval(t)},[s.timerRunning]);const r=t=>n(a=>({...a,...t})),c=t=>n(a=>({...a,focusMinutes:t,...a.timerMode==="focus"&&!a.timerRunning?{timerLeftSec:t*60}:{}})),h=t=>n(a=>({...a,breakMinutes:t,...a.timerMode==="break"&&!a.timerRunning?{timerLeftSec:t*60}:{}})),f=()=>n(t=>({...t,timerRunning:!t.timerRunning})),N=()=>n(t=>({...t,timerRunning:!1,timerLeftSec:(t.timerMode==="focus"?t.focusMinutes:t.breakMinutes)*60})),b=t=>n(a=>({...a,timerMode:t,timerRunning:!1,timerLeftSec:(t==="focus"?a.focusMinutes:a.breakMinutes)*60})),d=t=>n(a=>({...a,checklist:{...a.checklist,[t]:!a.checklist[t]}})),[m,g]=o.useState([]),[v,x]=o.useState({}),[S,T]=o.useState(!1),[M,y]=o.useState(""),[P,C]=o.useState(null),D=t=>{const a=t?.message||"";return a.includes("401")?"401 Unauthorized — жүйеге кіріңіз (JWT/куки).":a.includes("403")?"403 Forbidden — қолжетімсіз (рөл/доступ) немесе куки/JWT жіберілмеді.":a||"Сервер қатесі."},L=async()=>{T(!0),y("");try{const{items:t,source:a}=await F({fallback:!0,withSource:!0});if(C(a),a==="server"){g(Array.isArray(t)?t:[]);const l={};(t||[]).forEach(i=>{l[i.id]=!!(i.completed??i.done??!1)}),x(l)}else g([]),x({})}catch(t){y(D(t)),g([]),x({}),C(null)}finally{T(!1)}};o.useEffect(()=>{L()},[]);const A=async t=>{x(l=>({...l,[t]:!l[t]}));const a=!!v[t];try{const l=await $(t,p(),a);x(i=>({...i,[t]:!!l}))}catch(l){x(i=>({...i,[t]:a})),y(D(l))}};return u(s.bedtime),u(s.wakeTime),e.jsxs("div",{className:"container mx-auto max-w-6xl px-4 py-10",children:[e.jsxs(q.h1,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"text-3xl md:text-4xl font-extrabold text-slate-900",children:["LifeCharge — ",e.jsx("span",{className:"text-emerald-600",children:"Digital Detox (PQ)"})]}),e.jsx("p",{className:"mt-2 text-slate-600",children:"Фокус-таймер, су трекері, ұйқы/DND және серверлік Detox-чеклист. Дерек құрылғыда сақталады."}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"rounded-2xl border border-emerald-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"font-bold text-slate-900",children:"Focus Timer"}),e.jsx("div",{className:"mt-2 text-sm text-slate-600",children:s.timerMode==="focus"?"Терең жұмыс уақыты":"Үзіліс уақыты"}),e.jsxs("div",{className:"mt-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>b("focus"),className:`px-3 py-2 rounded-xl text-sm font-semibold border ${s.timerMode==="focus"?"bg-emerald-600 text-white border-emerald-600":"border-slate-300"}`,children:"Focus"}),e.jsx("button",{onClick:()=>b("break"),className:`px-3 py-2 rounded-xl text-sm font-semibold border ${s.timerMode==="break"?"bg-emerald-600 text-white border-emerald-600":"border-slate-300"}`,children:"Break"}),e.jsxs("div",{className:"ml-auto text-sm text-slate-600",children:["Бүгінгі сессия: ",e.jsx("b",{children:s.sessionsDoneToday})]})]}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("div",{className:"text-5xl font-bold tracking-tight",children:B(s.timerLeftSec)}),e.jsxs("div",{className:"mt-4 flex justify-center gap-3",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 rounded-xl bg-emerald-600 text-white font-semibold",children:s.timerRunning?"Пауза":"Бастау"}),e.jsx("button",{onClick:N,className:"px-4 py-2 rounded-xl border border-slate-300 font-semibold",children:"Қалпына келтіру"})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600",children:"Focus уақыты (мин)"}),e.jsx("select",{value:s.focusMinutes,onChange:t=>c(Number(t.target.value)),className:"mt-1 w-full rounded-xl border border-slate-300 px-3 py-2",children:[20,25,30,45,60].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600",children:"Break уақыты (мин)"}),e.jsx("select",{value:s.breakMinutes,onChange:t=>h(Number(t.target.value)),className:"mt-1 w-full rounded-xl border border-slate-300 px-3 py-2",children:[3,5,10,15].map(t=>e.jsx("option",{value:t,children:t},t))})]})]})]}),e.jsxs("div",{className:"rounded-2xl border border-sky-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"font-bold text-slate-900",children:"Су трекері"}),e.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Күніңіздегі таза су мөлшері — мақсатқа жақындаңыз."}),e.jsxs("div",{className:"mt-4 flex items-center gap-4",children:[e.jsx("button",{onClick:()=>r({waterCups:Math.max(0,s.waterCups-1)}),className:"px-3 py-2 rounded-xl border border-slate-300 font-semibold",children:"− 1 стақан"}),e.jsx("div",{className:"text-4xl font-bold tabular-nums",children:s.waterCups}),e.jsx("button",{onClick:()=>r({waterCups:Math.min(99,s.waterCups+1)}),className:"px-3 py-2 rounded-xl bg-sky-600 text-white font-semibold",children:"+ 1 стақан"}),e.jsxs("div",{className:"ml-auto text-sm text-slate-600",children:["Мақсат: ",e.jsx("b",{children:s.waterTarget})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("input",{type:"range",min:4,max:16,value:s.waterTarget,onChange:t=>r({waterTarget:Number(t.target.value)}),className:"w-full"})}),e.jsxs("div",{className:"mt-2 text-sm text-slate-600",children:["Прогресс:"," ",Math.min(100,Math.round(s.waterCups/Math.max(1,s.waterTarget)*100)),"%"]})]}),e.jsxs("div",{className:"rounded-2xl border border-indigo-200 bg-white p-5 shadow-sm",children:[e.jsx("h2",{className:"font-bold text-slate-900",children:"Ұйқы және DND жоспары"}),e.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Ұйқыға дейін және ұйқыдан кейін телефонсыз уақыт белгілеңіз."}),e.jsxs("div",{className:"mt-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600",children:"Ұйқы уақыты"}),e.jsx("input",{type:"time",value:s.bedtime,onChange:t=>r({bedtime:t.target.value}),className:"mt-1 w-full rounded-xl border border-slate-300 px-3 py-2"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:["Ұйқыға дейін:"," ",e.jsxs("b",{children:[Math.floor(u(s.bedtime)/60)," сағ ",u(s.bedtime)%60," мин"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-600",children:"Ояну уақыты"}),e.jsx("input",{type:"time",value:s.wakeTime,onChange:t=>r({wakeTime:t.target.value}),className:"mt-1 w-full rounded-xl border border-slate-300 px-3 py-2"}),e.jsxs("div",{className:"mt-1 text-xs text-slate-500",children:["Оянуға:"," ",e.jsxs("b",{children:[Math.floor(u(s.wakeTime)/60)," сағ ",u(s.wakeTime)%60," мин"]})]})]})]}),e.jsxs("label",{className:"mt-4 inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:s.eveningDnd,onChange:()=>r({eveningDnd:!s.eveningDnd})}),e.jsx("span",{className:"text-sm text-slate-700",children:"Ұйқыға 30 мин қалғанда «телефон ұстамаймын» (жоспар)"})]}),e.jsx("div",{className:"mt-3 text-xs text-slate-500",children:"Ескерту: Бұл тек жоспар/ескерту құралы. Құралдың жүйелік параметрлерін өзгертпейді."})]}),e.jsxs("div",{className:"rounded-2xl border border-amber-200 bg-white p-5 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"font-bold text-slate-900",children:"Күндік Detox-чеклист (сервер)"}),e.jsx("button",{onClick:L,className:"ml-auto rounded-xl border border-slate-300 px-3 py-1 text-sm font-semibold",children:"Қайта жүктеу"})]}),e.jsxs("p",{className:"mt-1 text-sm text-slate-600",children:["Тізім бекэндтен келеді. Белгі қою — бірден серверге жазылады (күн: ",p(),")."]}),M&&e.jsx("div",{className:"mt-3 text-sm text-rose-600",children:M}),S&&e.jsx("div",{className:"mt-3 text-sm text-slate-500",children:"Жүктелуде…"}),!S&&m.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 space-y-3",children:m.map(t=>e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:!!v[t.id],onChange:()=>A(t.id)}),e.jsxs("span",{className:"text-slate-800",children:[e.jsx("b",{children:t.title}),t.description?e.jsxs("span",{className:"text-slate-500",children:[" — ",t.description]}):null]})]},t.id))}),e.jsxs("div",{className:"mt-4 text-sm text-slate-600",children:["Орындағандар:"," ",e.jsxs("b",{children:[Object.values(v).filter(Boolean).length," / ",m.length]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mt-4 text-xs text-slate-500",children:P==="fallback"?"Сервер қолжетімсіз — локалдық чеклист:":"Локалдық чеклист:"}),e.jsx("div",{className:"mt-2 space-y-3",children:[["morningNoPhone","Таңғы 30 мин — телефон жоқ"],["eveningNoPhone","Ұйқыға 30 мин қалғанда — телефон жоқ"],["walk","15 мин жаяу жүру"],["stretch","5 мин созылу"]].map(([t,a])=>e.jsxs("label",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:!!s.checklist[t],onChange:()=>d(t)}),e.jsx("span",{className:"text-slate-800",children:a})]},t))}),e.jsxs("div",{className:"mt-4 text-sm text-slate-600",children:["Орындағандар:"," ",e.jsxs("b",{children:[Object.values(s.checklist).filter(Boolean).length," /"," ",Object.keys(s.checklist).length]})]}),e.jsx("button",{onClick:()=>n(t=>({...t,checklist:{morningNoPhone:!1,eveningNoPhone:!1,walk:!1,stretch:!1}})),className:"mt-3 px-4 py-2 rounded-xl border border-slate-300 font-semibold",children:"Чеклистті тазалау"})]})]})]}),e.jsxs("div",{className:"mt-8 text-xs text-slate-500",children:["Күн ауысқанда — сессия, су және чеклист автоматты түрде нөлденеді. Барлық дерек тек осы құрылғыда сақталады (",w,")."]})]})}export{U as default};
//# sourceMappingURL=LifeCharge-B3RVcGKr.js.map
