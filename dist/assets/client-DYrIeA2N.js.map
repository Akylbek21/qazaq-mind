{"version":3,"file":"client-DYrIeA2N.js","sources":["../../src/api/client.js"],"sourcesContent":["// src/api/client.js\r\nimport http from \"@/lib/http\";\r\n\r\n/**\r\n * normalizePath:\r\n *  - абсолютные URL (http://, https://, //) не трогаем\r\n *  - гарантируем один ведущий слэш\r\n *  - если baseURL заканчивается на '/api', снимаем ведущий '/api' у path\r\n *  - схлопываем повторные слэши в середине пути\r\n */\r\nexport function normalizePath(p) {\r\n  let s = String(p ?? \"\");\r\n  if (/^(https?:)?\\/\\//i.test(s)) return s; // абсолютный URL — возвращаем как есть\r\n\r\n  if (!s.startsWith(\"/\")) s = `/${s}`;\r\n  const base = String(http.defaults.baseURL || \"\");\r\n\r\n  if (/\\/api\\/?$/i.test(base)) {\r\n    s = s.replace(/^\\/api(\\/|$)/i, \"/\");\r\n  }\r\n\r\n  // Не затрагиваем схему вида 'http://', но схлопываем лишние слэши дальше по пути\r\n  s = s.replace(/([^:])\\/{2,}/g, \"$1/\");\r\n  return s;\r\n}\r\n\r\n/** Вспомогательное слияние config с безопасным объединением заголовков */\r\nfunction mergeCfg(cfg, extra) {\r\n  const headers = { ...(cfg?.headers || {}), ...(extra?.headers || {}) };\r\n  return { ...cfg, ...extra, headers };\r\n}\r\n\r\n/** Добавляет заголовок, чтобы перехватчик 401 не редиректил на /login */\r\nexport function skipAuth(config) {\r\n  return mergeCfg(config, { headers: { \"X-Skip-Auth-Redirect\": \"1\" } });\r\n}\r\n\r\n/* ----------------------------- JSON helpers ----------------------------- */\r\n// ВАЖНО: для GET/DELETE можно передавать query-параметры через config.params\r\n\r\nexport async function getJSON(path, config = {}) {\r\n  const { data } = await http.get(normalizePath(path), config);\r\n  return data;\r\n}\r\n\r\nexport async function delJSON(path, config = {}) {\r\n  const { data } = await http.delete(normalizePath(path), config);\r\n  return data;\r\n}\r\n\r\nexport async function postJSON(path, body, config = {}) {\r\n  const { data } = await http.post(normalizePath(path), body, config);\r\n  return data;\r\n}\r\n\r\nexport async function putJSON(path, body, config = {}) {\r\n  const { data } = await http.put(normalizePath(path), body, config);\r\n  return data;\r\n}\r\n\r\nexport async function patchJSON(path, body, config = {}) {\r\n  const { data } = await http.patch(normalizePath(path), body, config);\r\n  return data;\r\n}\r\n\r\n/* --------------------------- Forms / Uploads ---------------------------- */\r\n// НЕ ставим Content-Type вручную — axios добавит boundary сам\r\nexport async function postForm(path, formData, config = {}) {\r\n  const { data } = await http.post(normalizePath(path), formData, config);\r\n  return data;\r\n}\r\n\r\n/* ----------------------------- Downloads -------------------------------- */\r\nexport async function downloadBlob(path, config = {}) {\r\n  const cfg = mergeCfg({ responseType: \"blob\" }, config);\r\n  const res = await http.get(normalizePath(path), cfg);\r\n  const cd = res.headers?.[\"content-disposition\"] || \"\";\r\n  const m = cd.match(/filename\\*?=(?:UTF-8'')?[\"']?([^\"';]+)[\"']?/i);\r\n  const filename = m ? decodeURIComponent(m[1]) : \"download.bin\";\r\n  const contentType = res.headers?.[\"content-type\"] || \"application/octet-stream\";\r\n  return { blob: res.data, filename, contentType };\r\n}\r\n\r\nconst api = {\r\n  normalizePath,\r\n  skipAuth,\r\n  getJSON,\r\n  delJSON,\r\n  postJSON,\r\n  putJSON,\r\n  patchJSON,\r\n  postForm,\r\n  downloadBlob,\r\n};\r\n\r\nexport default api;\r\n"],"names":["normalizePath","p","s","base","http","getJSON","path","config","data","postJSON","body"],"mappings":"wCAUO,SAASA,EAAcC,EAAG,CAC/B,IAAIC,EAAI,OAAOD,GAAK,EAAE,EACtB,GAAI,mBAAmB,KAAKC,CAAC,EAAG,OAAOA,EAElCA,EAAE,WAAW,GAAG,IAAGA,EAAI,IAAIA,CAAC,IACjC,MAAMC,EAAO,OAAOC,EAAK,SAAS,SAAW,EAAE,EAE/C,MAAI,aAAa,KAAKD,CAAI,IACxBD,EAAIA,EAAE,QAAQ,gBAAiB,GAAG,GAIpCA,EAAIA,EAAE,QAAQ,gBAAiB,KAAK,EAC7BA,CACT,CAgBO,eAAeG,EAAQC,EAAMC,EAAS,GAAI,CAC/C,KAAM,CAAE,KAAAC,CAAI,EAAK,MAAMJ,EAAK,IAAIJ,EAAcM,CAAI,EAAGC,CAAM,EAC3D,OAAOC,CACT,CAOO,eAAeC,EAASH,EAAMI,EAAMH,EAAS,CAAA,EAAI,CACtD,KAAM,CAAE,KAAAC,GAAS,MAAMJ,EAAK,KAAKJ,EAAcM,CAAI,EAAGI,EAAMH,CAAM,EAClE,OAAOC,CACT"}